<!--
=========================================================
* 杭州消防信息可视化系统 - v1.0.0
=========================================================
* Copyright  启真湖底划水
=========================================================
-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="杭州消防信息可视化系统">
  <meta name="author" content="启真湖底划水">
  <title>杭州消防信息可视化系统</title>
  <!-- Favicon -->
  <link rel="icon" href="assets/img/logo.png" type="image/png">
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="assets/vendor/nucleo/css/nucleo.css" type="text/css">
  <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
  <!-- Page plugins -->
  <!-- Argon CSS -->
  <link rel="stylesheet" href="assets/css/argon.css?v=1.2.0" type="text/css">
  <!--Map-->
  
  <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>

  <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=d644ec9c6fac203f3818eb86bbeba5fe&plugin=AMap.Geocoder"></script>
  <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=d644ec9c6fac203f3818eb86bbeba5fe&plugin=AMap.Driving"></script>



  <script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
  <style type="text/css">

    </style>
    <style type="text/css">
        #containerMap{
          width: 100%;
          height: 100%;
        }
        #panel1 {
            position: fixed;
            background-color: white;
            max-height: 420px;
            overflow-y: auto;
            top: 120px;
            right: 20px;
            width: 320px;
        }
        #panel1 .amap-call {
            background-color: #009cf9;
            border-top-left-radius: 4px;
   	        border-top-right-radius: 4px;
        }
        #panel1 .amap-lib-driving {
	        border-bottom-left-radius: 4px;
   	        border-bottom-right-radius: 4px;
            overflow: hidden;
        }




    </style>

</head>
<body>
  <!-- Sidenav -->
  <nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    <div class="scrollbar-inner">
      <!-- Brand -->
      <!--<div class="sidenav-header  align-items-center" style="height:200px;">
        <a class="navbar-brand">
          <img src="assets/img/logo.png" class="navbar-brand-img" style="height:200px;width: 200px;" >
        </a>
      </div>-->
      <div class="navbar-inner">
        <!-- Collapse -->
        <div class="collapse navbar-collapse" id="sidenav-collapse-main">
          <!-- Nav items -->
          <!-- Heading -->
          <h4 class="navbar-heading p-0" style="margin-bottom: -10px;">
            <img alt="" src="./assets/img/logo1.png" style="width: 100%;height: 100%;" />
          </h4>
          <!-- Divider -->
          <hr class="my-3">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link " href="index.html">
                <i class="ni ni-chart-pie-35 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防数据可视化</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="onlinemap.html">
                <i class="ni ni-pin-3 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">在线消防地图</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="routemanage.html">
                <i class="ni ni-compass-04 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防出警规划</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="accessibility.html">
                <i class="ni ni-key-25 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防可达度分析</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="info.html">
                <i class="ni ni-bullet-list-67 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">最新火情信息</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="knowledge.html">
                <i class="ni ni-ruler-pencil text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防小贴士</span>
              </a>
            </li> 



            <!--
            <li class="nav-item">
              <a class="nav-link" href="examples/upgrade.html">
                <i class="ni ni-send text-dark"></i>
                <span class="nav-link-text">Upgrade</span>
              </a>
            </li>
            -->
          </ul>
          
          
          <!-- Navigation -->
          
          <ul class="navbar-nav mb-md-3">
            <!--
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html" target="_blank">
                <i class="ni ni-spaceship"></i>
                <span class="nav-link-text">Getting started</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html" target="_blank">
                <i class="ni ni-palette"></i>
                <span class="nav-link-text">Foundation</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html" target="_blank">
                <i class="ni ni-ui-04"></i>
                <span class="nav-link-text">Components</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/plugins/charts.html" target="_blank">
                <i class="ni ni-chart-pie-35"></i>
                <span class="nav-link-text">Plugins</span>
              </a>
            </li>
            -->


            <li class="nav-item">
              <a class="nav-link active active-pro" href="index.html">
                <i class="ni ni-send text-primary"></i>
                <span class="nav-link-text">返回首页</span>
              </a>
            </li>
          </ul>
          
          
        </div>
      </div>
    </div>
  </nav>
  <!-- Main content -->
  <div class="main-content" id="panel">
    <!-- Header -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row align-items-center py-4">
            <div class="col-lg-6 col-6">
              <div class="text-white d-inline-block mb-0" style="font-size: x-large;margin-bottom: 10px;margin-top: 10px;">消防出警规划</div>
            </div>
            <div class="col-lg-3 col-5 text-right">
              <div class="col">
                <h4 class='txt-l text-white mb6'>消防救援大队：</h4>
              </div>
              <div class="row">
                  
                  <div class="col">        
                    <div id='params' class='mb12 mr12 toggle-group align-center'>
                      <select name="place" id="place">
                        <option value="0">滨江区消防救援大队</option>
                        <option value="1">上城区消防救援大队</option>
                        <option value="2">余杭区消防救援大队</option>
                        <option value="3">下城区消防救援大队</option>
                        <option value="4">萧山区消防救援大队</option>
                        <option value="5">富阳区消防救援大队</option>
                        <option value="6">临安区消防救援大队</option>
                        <option value="7"> 西湖风景名胜区消防救援大队</option>
                        <option value="8">钱塘新区消防救援大队</option>
                        <option value="9">淳安县消防救援大队</option>
                        <option value="10">西湖区消防救援大队</option>
                        <option value="11">江干区消防救援大队</option>
                        <option value="12">建德市消防救援大队</option>
                        <option value="13">桐庐县消防救援大队</option>
                        <option value="14">拱墅区消防救援大队</option>
                        <option value="15">滨江区消防救援大队</option>
                      </select>
                    </div>
                    </div>
                  </div>
              </div> 
            <div class="col-lg-2 col-4" style="margin-left: 40px;">
              <!-- Button trigger modal -->
            <button type="button" class="btn btn-neutral" data-toggle="modal" data-target="#exampleModal">
              火警申报
            </button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">火警申报</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form>
                      <div class="form-group">
                          <label for="example-text-input" class="form-control-label">详细地点</label>
                          <input class="form-control" type="text" id="example-text-input">
                      </div>
                      <div class="form-group">
                        <label for="example-tel-input" class="form-control-label">联系方式</label>
                        <input class="form-control" type="tel"  id="example-tel-input">
                     </div>
                      <div class="form-group">
                          <label for="example-tel-input" class="form-control-label">您的电话</label>
                          <input class="form-control" type="tel"  id="example-tel-input">
                      </div>
                     
                  </form>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">提交</button>
                  </div>
                </div>
              </div>
            </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
    <!-- Page content -->
    
    <div class="container mt--6">
      <div class="row" >
        <div class="col" >
          <div class="card border-0">
            <div id="containerMap" class="map-canvas" data-lat="40.748817" data-lng="-73.985428" style="height: 470px;">
            </div>


            <div id="panel1"></div>
          </div>
        </div>
      </div>

  </div>  
  </div>
  
  <!-- Argon Scripts -->
  <!-- Core -->
  <script src="assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/js-cookie/js.cookie.js"></script>
  <script src="assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
  <script src="assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
  <!-- Optional JS -->
  <script src="assets/vendor/chart.js/dist/Chart.min.js"></script>
  <script src="assets/vendor/chart.js/dist/Chart.extension.js"></script>
  <!-- Optional JS -->
  
  <!-- Argon JS -->
  <script src="assets/js/argon.js?v=1.2.0"></script>
  <script type="text/javascript">
    //基本地图加载
    var map = new AMap.Map("containerMap", {
        resizeEnable: true,
        center: [120.07, 30.16023],//地图中心点
        zoom: 13 //地图显示的缩放级别
    });
    var data1;
    var lnglat1;
        //构造路线导航类
    var driving = new AMap.Driving({
        map: map,
        panel: "panel1",
        policy: AMap.DrivingPolicy.LEAST_TIME
    }); 
    AMap.plugin('AMap.Geolocation', function() {
        var geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：5s
            buttonPosition:'RB',    //定位按钮的停靠位置
            buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            zoomToAccuracy: true,   //定位成功后是否自动调整地图视野到定位点

        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition(function(status,result){
          console.log(result);
          if(result.info=="FAILED")
          {
            alert("无法获取位置信息，请手动选点");
            map.on("click",function(e){
              lnglat1=e.lnglat;
/*
            var geocoder = new AMap.Geocoder({
                city: "杭州", 
            });

            geocoder.getLocation("滨江区消防救援大队", function(status, result) {
              if (status === 'complete'&&result.geocodes.length) {
                var lnglat = result.geocodes[0].location;
                lnglat1= lnglat;
              }else{
                log.error('根据地址查询位置失败');
              }
            });*/

            AMap.plugin('AMap.Geocoder', function() {
              var geocoder = new AMap.Geocoder({
    // city 指定进行编码查询的城市，支持传入城市名、adcode 和 citycode
                city: '杭州'
              })

            var selects = document.getElementById("place");
            var indexs = selects.selectedIndex;  //选中项的索引
            //alert(selects.options[indexs].text);
            geocoder.getLocation(selects.options[indexs].text, function(status, result) {
                if (status === 'complete' && result.info === 'OK') {

                  var lnglat = result.geocodes[0].location;


                  // 根据起终点经纬度规划驾车导航路线

                  driving.search(lnglat, e.lnglat, function(status, result) {
                  // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
                    if (status === 'complete') {
                      log.success('绘制驾车路线完成')
                    } else {
                      log.error('获取驾车数据失败：' + result)
                    }
                  });
                }else{
                    log.error('根据地址查询位置失败');
                }
                
              })
            });









            });//单击结束



          }//if结束

          else
          {
            if(status=='complete'){
              onComplete(result)
                //console.log(result)
            }
            else
            {
              onError(result)
            }
          }

        });
    });
    //解析定位结果
    function onComplete(data) {
      data1=data;
      /*
      AMap.plugin('AMap.Autocomplete', function(){
      // 实例化Autocomplete
      var autoOptions = {
        //city 限定城市，默认全国
        city: '杭州'
      }
      var autoComplete= new AMap.Autocomplete(autoOptions);
      autoComplete.search("消防站", function(status, result) {
        // 搜索成功时，result即是对应的匹配数据
        console.log(result)
      })
    })*/
      
      // 根据起终点名称规划驾车导航路线
    driving.search([
        {keyword: '滨江区消防救援大队',city:'杭州'},
        {keyword:data.formattedAddress,city:'杭州'}
    ], function(status, result) {
        // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
        if (status === 'complete') {
            log.success('绘制驾车路线完成')
        } else {
            log.error('获取驾车数据失败：' + result)
        }
    });
    }
    //解析定位错误信息
    function onError(data) {
        
    }


    place.addEventListener('change', function (e) {
    console.log(e.target.selectedOptions[0].text);
    //alert(lnglat1);
    if(lnglat1==undefined)
    {
      if(data1!=undefined)
        if(data1.info!="FAILED")
        {
          driving.search([
            {keyword:e.target.selectedOptions[0].text,city:'杭州'},
            {keyword:data1.formattedAddress,city:'杭州'},


            ], function(status, result) {
        // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
        if (status === 'complete') {
          log.success('绘制驾车路线完成')
        } else {
          log.error('获取驾车数据失败：' + result)
        }
      });
        }
      } 
      else
      {
            AMap.plugin('AMap.Geocoder', function() {
              var geocoder = new AMap.Geocoder({
    // city 指定进行编码查询的城市，支持传入城市名、adcode 和 citycode
                city: '杭州'
              })

            var selects = document.getElementById("place");
            var indexs = selects.selectedIndex;  //选中项的索引
            //alert(selects.options[indexs].text);
            geocoder.getLocation(selects.options[indexs].text, function(status, result) {
                if (status === 'complete' && result.info === 'OK') {

                  var lnglat = result.geocodes[0].location;


                  // 根据起终点经纬度规划驾车导航路线

                  driving.search(lnglat, lnglat1, function(status, result) {
                  // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
                    if (status === 'complete') {
                      log.success('绘制驾车路线完成')
                    } else {
                      log.error('获取驾车数据失败：' + result)
                    }
                  });
                }else{
                    log.error('根据地址查询位置失败');
                }
                
              })
            });

      }




  });
    
    

  
</script>
</body>

</html>
