<!--
=========================================================
* 杭州消防信息可视化系统 - v1.0.0
=========================================================
* Copyright  启真湖底划水
=========================================================
-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="杭州消防信息可视化系统">
  <meta name="author" content="启真湖底划水">
  <title>杭州消防信息可视化系统</title>
  <!-- Favicon -->
  <link rel="icon" href="assets/img/logo.png" type="image/png">
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="assets/vendor/nucleo/css/nucleo.css" type="text/css">
  <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
  <!-- Page plugins -->
  <!-- Argon CSS -->
  <link rel="stylesheet" href="assets/css/argon.css?v=1.2.0" type="text/css">
  <!-- Import Mapbox GL JS  -->
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css' rel='stylesheet' />
  <!-- Import Assembly -->
  <link href='https://api.mapbox.com/mapbox-assembly/v0.23.2/assembly.min.css' rel='stylesheet'>
  <script src='https://api.mapbox.com/mapbox-assembly/v0.23.2/assembly.js'></script>
  <!-- Import jQuery -->
  <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
</head>

<body>
  <!-- Sidenav -->
  <nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    <div class="scrollbar-inner">
      <!-- Brand -->
      <!--<div class="sidenav-header  align-items-center" style="height:200px;">
        <a class="navbar-brand">
          <img src="assets/img/logo.png" class="navbar-brand-img" style="height:200px;width: 200px;" >
        </a>
      </div>-->
      <div class="navbar-inner">
        <!-- Collapse -->
        <div class="collapse navbar-collapse" id="sidenav-collapse-main">
          <!-- Nav items -->
          <!-- Heading -->
          <h4 class="navbar-heading p-0" style="margin-bottom: -10px;">
            <img alt="" src="./assets/img/logo1.png" style="width: 100%;height: 100%;" />
          </h4>
          <!-- Divider -->
          <hr class="my-3">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link " href="index.html">
                <i class="ni ni-chart-pie-35 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防数据可视化</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="onlinemap.html">
                <i class="ni ni-pin-3 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">在线消防地图</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="routemanage.html">
                <i class="ni ni-compass-04 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防出警规划</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="accessibility.html">
                <i class="ni ni-key-25 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防可达度分析</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="info.html">
                <i class="ni ni-bullet-list-67 text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">最新火情信息</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="knowledge.html">
                <i class="ni ni-ruler-pencil text-primary"></i>
                <span class="nav-link-text" style="font-size:medium">消防小贴士</span>
              </a>
            </li>



            <!--
            <li class="nav-item">
              <a class="nav-link" href="examples/upgrade.html">
                <i class="ni ni-send text-dark"></i>
                <span class="nav-link-text">Upgrade</span>
              </a>
            </li>
            -->
          </ul>


          <!-- Navigation -->

          <ul class="navbar-nav mb-md-3">
            <!--
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html" target="_blank">
                <i class="ni ni-spaceship"></i>
                <span class="nav-link-text">Getting started</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html" target="_blank">
                <i class="ni ni-palette"></i>
                <span class="nav-link-text">Foundation</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html" target="_blank">
                <i class="ni ni-ui-04"></i>
                <span class="nav-link-text">Components</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/plugins/charts.html" target="_blank">
                <i class="ni ni-chart-pie-35"></i>
                <span class="nav-link-text">Plugins</span>
              </a>
            </li>
            -->


            <li class="nav-item">
              <a class="nav-link active active-pro" href="index.html">
                <i class="ni ni-send text-primary"></i>
                <span class="nav-link-text">返回首页</span>
              </a>
            </li>
          </ul>


        </div>
      </div>
    </div>
  </nav>
  <!-- Main content -->
  <div class="main-content" id="panel">
    <!-- Header -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row align-items-center py-4">
            <div class="col-lg-6 col-7">
              <div class="text-white d-inline-block mb-0" style="font-size: x-large;">在线消防地图</div>
            </div>
            <div class="col-lg-6 col-5 text-right">
              <a href="#" class="btn btn-neutral" style="font-size: large;">逃生消防图</a>
              <a href="#" class="btn btn-neutral" style="font-size: large;">寻找消防栓</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Page content -->
    <div class="container mt--6">
      <div class="row">
        <div class="col">
          <div class="card border-0">
            <div id="map" class="map-canvas" style="height: 480px;"></div>
            <div class='absolute fl my24 mx24 py24 px24 bg-gray-faint round'>
              <form id='params'>
                <h4 class='txt-m txt-bold mb6'>出警时间：</h4>
                <div class='mb12 mr12 toggle-group align-center'>
                  <label class='toggle-container'>
                    <input name='duration' type='radio' value='5' checked>
                    <div class='toggle toggle--active-null toggle--null'>5 min</div>
                  </label>
                  <label class='toggle-container'>
                    <input name='duration' type='radio' value='15'>
                    <div class='toggle toggle--active-null toggle--null'>15 min</div>
                  </label>
                  <label class='toggle-container'>
                    <input name='duration' type='radio' value='25'>
                    <div class='toggle toggle--active-null toggle--null'>25 min</div>
                  </label>
                </div>
                <h4 class='txt-m txt-bold mb6'>消防救援大队：</h4>
                <div class='mb12 mr12 toggle-group align-center'>
                  <select name="place" id="place">
                    <option value="0">滨江区消防救援大队</option>
                    <option value="1">上城区消防救援大队</option>
                    <option value="2">余杭区消防救援大队</option>
                    <option value="3">下城区消防救援大队</option>
                    <option value="4">萧山区消防救援大队</option>
                    <option value="5">富阳区消防救援大队</option>
                    <option value="6">临安区消防救援大队</option>
                    <option value="7"> 西湖风景名胜区消防救援大队</option>
                    <option value="8">钱塘新区消防救援大队</option>
                    <option value="9">淳安县消防救援大队</option>
                    <option value="10">西湖区消防救援大队</option>
                    <option value="11">江干区消防救援大队</option>
                    <option value="12">建德市消防救援大队</option>
                    <option value="13">桐庐县消防救援大队</option>
                    <option value="14">拱墅区消防救援大队</option>
                    <option value="15">滨江区消防救援大队</option>
                  </select>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Argon Scripts -->
    <!-- Core -->
    <script src="assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/js-cookie/js.cookie.js"></script>
    <script src="assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
    <script src="assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
    <!-- Optional JS -->
    <script src="assets/vendor/chart.js/dist/Chart.min.js"></script>
    <script src="assets/vendor/chart.js/dist/Chart.extension.js"></script>
    <!-- Optional JS -->
    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTTfWur0PDbZWPr7Pmq8K3jiDp0_xUziI"></script> -->
    <!-- Argon JS -->
    <script src="assets/js/argon.js?v=1.2.0"></script>
</body>
<script>
  // Add your Mapbox access token
  mapboxgl.accessToken = 'pk.eyJ1IjoibGl6MDEyNiIsImEiOiJja2p1czBubHYwMmM0MnlsZjR6cHlkZHl0In0.OBEsP2LB-_eiUz763oUi9g';
  var map = new mapboxgl.Map({
    container: 'map', // Specify the container ID
    style: 'mapbox://styles/mapbox/streets-v11', // Specify which map style to use
    center: [120.2, 30.168593], // Specify the starting position
    zoom: 9, // Specify the starting zoom
  });

  // // Create variables to use in getIso()
  var urlBase = 'https://api.mapbox.com/isochrone/v1/mapbox/';
  var lonArray = [120.198542, 120.196345, 120.278611, 120.159986, 120.265835, 119.935855, 119.703803, 120.113328,
    120.322707, 119.029273, 120.09058, 120.207962, 119.33711, 119.709786, 120.136654, 120.14534];
  var latArray = [30.168593, 30.232534, 30.40711, 30.284215, 30.137964, 30.066059, 30.220898, 30.246424,
    30.291017, 29.596175, 30.280619, 30.267521, 29.514522, 29.799713, 30.303451, 30.156555,];
  var profile = 'driving';
  var minutes = 5;
  var marker = new mapboxgl.Marker({
    'color': '#314ccd'
  });
  var lngLat = {
    lon: 120.198542,
    lat: 30.168593
  };
  marker.setLngLat(lngLat).addTo(map);

  // Create a function that sets up the Isochrone API query then makes an Ajax call
  function getIso() {
    var query = urlBase + profile + '/' + lngLat.lon + ',' + lngLat.lat + '?contours_minutes=' + minutes + '&polygons=true&access_token=' + mapboxgl.accessToken;

    $.ajax({
      method: 'GET',
      url: query
    }).done(function (data) {
      // Set the 'iso' source's data to what's returned by the API query
      map.getSource('iso').setData(data);
    })
  };

  map.on('load', function () {
    // When the map loads, add the source and layer
    map.addSource('iso', {
      type: 'geojson',
      data: {
        'type': 'FeatureCollection',
        'features': []
      }
    });

    map.addLayer({
      'id': 'isoLayer',
      'type': 'fill',
      // Use "iso" as the data source for this layer
      'source': 'iso',
      'layout': {},
      'paint': {
        // The fill color for the layer is set to a light purple
        'fill-color': '#5a3fc0',
        'fill-opacity': 0.3
      }
    }, "poi-label");

    // Make the API call
    getIso();
  });
  // Target the "params" form in the HTML portion of your code
  var params = document.getElementById('params');

  // When a user changes the value of profile or duration by clicking a button, change the parameter's value and make the API query again
  params.addEventListener('change', function (e) {
    if (e.target.name === 'duration') {
      minutes = e.target.value;
      getIso();
    }
    else if (e.target.name == 'place') {
      lngLat.lat = latArray[e.target.options.selectedIndex];
      lngLat.lon = lonArray[e.target.options.selectedIndex];
      marker.setLngLat(lngLat);
      getIso();
    }


  });





</script>

</html>